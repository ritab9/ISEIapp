<!-- apr_progress_reportB-->
{% extends 'accreditation_base.html' %}

{% block title %} APR Progress {% endblock title %}


{% block content %}

<div class="">

    <h6 class="text-center mt-2">Progress Overview for {{ apr }}</h6>

    {% include 'apr/progress_sectionB.html' with section_title='Priority Directive' directives_progress=priority_directives_progress %}

    {% include 'apr/progress_sectionB.html' with section_title='Directive' directives_progress=directives_progress %}

    {% include 'apr/progress_sectionB.html' with section_title='Recommendation' directives_progress=recommendations_progress %}

    {% include 'apr/progress_sectionB.html' with section_title='Action Plan' directives_progress=action_plans_progress %}


</div>


{% endblock %}


{% block footer_javascript %}

<script>

    function saveProgress(progressId, newDescription) {
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

        fetch(`/update_progress/${progressId}/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken,
            },
            body: JSON.stringify({ description: newDescription }),
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Failed to save progress');
            }
            return response.json();
        })
        .then(data => {
            if (data.description !== newDescription) {
                alert('Failed to update progress on the server.');
                console.error('Mismatch between server response and updated data.');
            } else {
                //alert('Progress saved successfully!');
                this.originalDescription = newDescription; // Update originalDescription with the new description
                // Successfully saved progress, close editing window and restore DOM
            }
        })
        .catch(error => {
            console.error('Error saving progress:', error);
            alert('An error occurred while saving progress. Please try again.');
        });
    }

    function updateProgressStatus(directive_id) {

            // Get the selected value from the dropdown
            const progressStatus = document.getElementById(`progress_status_${directive_id}`).value;

            // Send the update to the server using AJAX
            fetch("{% url 'update_progress_status' %}", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value // CSRF token for security
                },
                body: JSON.stringify({
                    directive_id: directive_id,
                    progress_status: progressStatus
                })
            })
            .then(response => {
                if (response.ok) {
                    alert('Progress status updated successfully!');
                } else {
                    alert('Failed to update progress status.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred.');
            });
        }

</script>

{% endblock %}


